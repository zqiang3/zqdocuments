## 惊群现象

master进程首先通过socket()来创建一个监听描述符，然后fork()若干个worker，子进程将继承父进程的监听描述符，之后子进程在该监听描述符上accept()创建已连接描述符（connected descriptor），然后通过已连接描述符来与客户端通信。

那么，由于所有子进程都继承了父进程的 sockfd，那么**当连接进来时**，所有子进程都将收到通知并“争着”与它建立连接，这就叫“惊群现象”。**大量的进程被激活又挂起**，只有一个进程可以accept() 到这个连接，这当然会消耗系统资源。



## Nginx对惊群现象的处理：
Nginx提供了一个accept_mutex这个东西，这是一个加在accept上的一把互斥锁。即每个worker进程在执行accept()之前都需要先获取锁，accept()成功之后再解锁。有了这把锁，同一时刻，只会有一个进程执行accpet()，这样就不会有惊群问题了。accept_mutex是一个可控选项，我们可以显示地关掉，默认是打开的。